(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/coupon"],{"0153":function(t,e,i){"use strict";var n=i("053c"),a=i.n(n);a.a},"053c":function(t,e,i){},"2fc8":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",[i("view",{staticClass:"navigation",style:{height:t.height}},[i("navigator",{staticClass:"left",attrs:{"open-type":"navigateBack","hover-class":"none"}},[i("image",{attrs:{src:"../../static/Merchan_registration/back.png",mode:""}})]),i("view",{staticClass:"title"},[t._v("创建优惠券")]),i("view",{staticClass:"right"})],1),i("view",{staticClass:"content",style:{paddingTop:t.height}},[i("view",{staticClass:"div_list"},[i("text",[t._v("开始日期")]),i("picker",{attrs:{mode:"date",value:t.date,start:t.startDate,end:t.endDate,eventid:"15606986-0"},on:{change:t.start_times}},[i("text",{directives:[{name:"show",rawName:"v-show",value:""==t.startTime,expression:"startTime==''"}]},[t._v("请选择开始时间")]),i("text",[t._v(t._s(t.startTime))]),i("image",{attrs:{src:"../../static/user/right.png",mode:""}})])],1),i("view",{staticClass:"div_list"},[i("text",[t._v("结束日期")]),i("picker",{attrs:{mode:"date",value:t.date,start:t.startDate,end:t.endDate,eventid:"15606986-1"},on:{change:t.endTimes}},[i("text",{directives:[{name:"show",rawName:"v-show",value:""==t.endTime,expression:"endTime==''"}]},[t._v("请输入结束时间")]),i("text",[t._v(t._s(t.endTime))]),i("image",{attrs:{src:"../../static/user/right.png",mode:""}})])],1),i("view",{staticClass:"div_list"},[i("text",[t._v("设定金额")]),i("view",{staticClass:"put"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.price,expression:"price"}],attrs:{type:"text",placeholder:"请输入金额",eventid:"15606986-2"},domProps:{value:t.price},on:{input:function(e){e.target.composing||(t.price=e.target.value)}}}),i("image",{attrs:{src:"../../static/user/right.png",mode:""}})])]),i("view",{staticClass:"div_list",attrs:{eventid:"15606986-3"},on:{tap:function(e){t.tg="block",t.grant=""}}},[i("text",[t._v("发放数量")]),i("view",[""==t.grant?i("text",[t._v("点击选择")]):i("text",[t._v(t._s(t.grant))]),i("image",{attrs:{src:"../../static/user/right.png",mode:""}})])]),i("view",{staticClass:"div_list",attrs:{eventid:"15606986-4"},on:{tap:function(e){t.coupon_tg="block",t.money=""}}},[i("text",[t._v("消费限制")]),i("view",[""==t.money?i("text",[t._v("点击选择")]):i("text",[t._v(t._s(t.money))]),i("image",{attrs:{src:"../../static/user/right.png",mode:""}})])]),i("button",{attrs:{type:"primary",eventid:"15606986-5"},on:{tap:t.sub}},[t._v("确定")]),i("view",{staticClass:"mask",style:{display:t.tg}},[i("view",{staticClass:"norms"},[i("view",{staticClass:"title"},[t._v("发放数量")]),i("view",{staticClass:"div_list"},[i("text",[t._v("限制发放数量")]),i("switch",{attrs:{checked:t.limit_bt,eventid:"15606986-6"},on:{change:t.limit}})]),i("view",{directives:[{name:"show",rawName:"v-show",value:t.limit_bt,expression:"limit_bt"}],staticClass:"div_list"},[i("text",[t._v("制定发放数量")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.grant,expression:"grant"}],staticClass:"grant_num",attrs:{type:"text",placeholder:"输入数量",eventid:"15606986-7"},domProps:{value:t.grant},on:{input:function(e){e.target.composing||(t.grant=e.target.value)}}})]),i("view",{staticClass:"btn"},[i("text",{staticClass:"cancel",attrs:{eventid:"15606986-8"},on:{tap:function(e){t.cancel()}}},[t._v("取消")]),i("text",{staticClass:"determine",attrs:{eventid:"15606986-9"},on:{tap:function(e){t.determine()}}},[t._v("确定")])])])]),i("view",{staticClass:"mask",style:{display:t.coupon_tg}},[i("view",{staticClass:"norms"},[i("view",{staticClass:"title"},[t._v("消费限制")]),i("view",{staticClass:"div_list"},[i("text",[t._v("限制最低消费金额")]),i("switch",{attrs:{checked:t.shop_limit_bt,eventid:"15606986-10"},on:{change:t.shop_limit}})]),i("view",{directives:[{name:"show",rawName:"v-show",value:t.shop_limit_bt,expression:"shop_limit_bt"}],staticClass:"div_list"},[i("text",[t._v("设置最低消费金额")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.money,expression:"money"}],staticClass:"grant_num",attrs:{type:"text",placeholder:"输入金额",eventid:"15606986-11"},domProps:{value:t.money},on:{input:function(e){e.target.composing||(t.money=e.target.value)}}})]),i("view",{staticClass:"btn"},[i("text",{staticClass:"cancel",attrs:{eventid:"15606986-12"},on:{tap:function(e){t.cancel()}}},[t._v("取消")]),i("text",{staticClass:"determine",attrs:{eventid:"15606986-13"},on:{tap:function(e){t.shop_determine()}}},[t._v("确定")])])])])],1)])},a=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return a})},"7a21":function(t,e,i){"use strict";i("b007");var n=s(i("b0ce")),a=s(i("e851"));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,n.default)(a.default))},"9d1c":function(t,e,i){"use strict";i.r(e);var n=i("e749"),a=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e["default"]=a.a},e749:function(t,e,i){"use strict";(function(t){function i(t){var e=new Date,i=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();return"start"===t?i-=100:"end"===t&&(i+=100),n=n>9?n:"0"+n,a=a>9?a:"0"+a,"".concat(i,"-").concat(n,"-").concat(a)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{height:"",date:i({format:!0}),startTime:"",endTime:"",tg:"none",coupon_tg:"none",limit_bt:!0,shop_limit_bt:!0,grant:"",money:"",price:"",merchantId:"",number:"",activitiesId:"",consumption:"",minimumConsumptionAmount:"",modify:"/api/merchant/red/modifyCoupons",establish:"/api/merchant/red/coupon",address:""}},onLoad:function(e){var i=this;console.log(e),i.activitiesId=e.activitiesId,t.getStorage({key:"userinfo",success:function(t){i.merchantId=t.data.id,e.activitiesId&&i.getInfor()}})},onReady:function(){this.getTopheight()},methods:{getTopheight:function(){var e=this;t.getSystemInfo({success:function(t){e.height=t.statusBarHeight+44+"px"}})},start_times:function(t){this.startTime=t.target.value},endTimes:function(t){this.endTime=t.target.value},determine:function(){var e=/^[1-9]\d*$/;if(0==this.limit_bt)this.grant="无限制";else{if(""==this.grant)return void t.showToast({title:"发放数量不能为空",icon:"none",mask:!1,duration:2e3});if(!e.test(this.grant))return void t.showToast({title:"发放数量输入有误",icon:"none",mask:!1,duration:2e3})}this.tg="none"},cancel:function(){this.tg="none",this.coupon_tg="none"},limit:function(t){this.limit_bt=t.detail.value},shop_determine:function(){var e=/^[+-]?\d+(\.\d+)?$|^$|^(\d+|\-){7,}$/;if(0==this.shop_limit_bt)this.money="无限制";else{if(""==this.money)return void t.showToast({title:"最低消费不能为空",icon:"none",mask:!1,duration:2e3});if(!e.test(this.money))return void t.showToast({title:"最低消费输入有误",icon:"none",mask:!1,duration:2e3})}this.coupon_tg="none"},shop_limit:function(t){this.shop_limit_bt=t.detail.value},sub:function(){var e=this;console.log(e.activitiesId),void 0==e.activitiesId?e.address=e.establish:e.address=e.modify,t.showLoading({title:"生成优惠券中",mask:!1});var i=/^[+-]?\d+(\.\d+)?$|^$|^(\d+|\-){7,}$/;if(""!=e.startTime)if(""!=e.endTime){var n=new Date(e.startTime),a=new Date(e.endTime);n.getTime()>a.getTime()?t.showToast({title:"结束时间不能小于开始时间",icon:"none",mask:!1,duration:2e3}):""!=e.price?i.test(e.price)?""!=e.grant?""!=e.money?(e.limit_bt?e.number=e.grant:e.number="",e.shop_limit_bt?e.minimumConsumptionAmount=e.money:e.minimumConsumptionAmount="",t.request({url:e.serveipd+e.address,method:"POST",data:{id:parseInt(e.activitiesId),startTime:e.startTime,endTime:e.endTime,price:e.price,quantity:e.number,minimumConsumptionAmount:e.minimumConsumptionAmount,numberStatus:e.limit_bt?1:0,minimumConsumptionStatus:e.shop_limit_bt?1:0,merchantId:e.merchantId},success:function(e){t.hideLoading(),t.showToast({title:e.data.msg,icon:"none",mask:!1,duration:1500,success:function(){0==e.data.code&&setTimeout(function(){t.redirectTo({url:"./marketing"})},1500)}})}})):t.showToast({title:"消费限制不能为空",icon:"none",mask:!1,duration:2e3}):t.showToast({title:"请选择发放数量",icon:"none",mask:!1,duration:2e3}):t.showToast({title:"金额输入有误",icon:"none",mask:!1,duration:2e3}):t.showToast({title:"请输入金额",icon:"none",mask:!1,duration:2e3})}else t.showToast({title:"请选择结束时间",icon:"none",mask:!1,duration:2e3});else t.showToast({title:"请选择开始时间",icon:"none",mask:!1,duration:2e3})},getInfor:function(){var e=this;t.request({url:this.serveipd+"/api/merchant/red/offerInformation",header:{content_type:"application/json"},method:"GET",data:{merchantId:e.merchantId,id:e.activitiesId},success:function(t){console.log(t),e.startTime=t.data.data.startTime,e.endTime=t.data.data.endTime,e.price=t.data.data.price,1==t.data.data.numberStatus?(e.limit_bt=!0,e.grant=t.data.data.quantity):(e.limit_bt=!1,e.grant="无限制"),1==t.data.data.minimumConsumptionStatus?(e.shop_limit_bt=!0,e.money=t.data.data.minimumConsumptionAmount):(e.shop_limit_bt=!1,e.money="无限制")},fail:function(){},complete:function(){}})}}};e.default=n}).call(this,i("6e42")["default"])},e851:function(t,e,i){"use strict";i.r(e);var n=i("2fc8"),a=i("9d1c");for(var s in a)"default"!==s&&function(t){i.d(e,t,function(){return a[t]})}(s);i("0153");var o=i("2877"),r=Object(o["a"])(a["default"],n["a"],n["b"],!1,null,null,null);e["default"]=r.exports}},[["7a21","common/runtime","common/vendor"]]]);