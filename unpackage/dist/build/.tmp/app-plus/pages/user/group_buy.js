(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/group_buy"],{"172d":function(t,e,i){"use strict";i.r(e);var s=i("913c"),a=i("d4a5");for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);i("790b");var o=i("2877"),c=Object(o["a"])(a["default"],s["a"],s["b"],!1,null,null,null);e["default"]=c.exports},3448:function(t,e,i){"use strict";i("b007");var s=n(i("b0ce")),a=n(i("172d"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,s.default)(a.default))},4609:function(t,e,i){},"790b":function(t,e,i){"use strict";var s=i("4609"),a=i.n(s);a.a},"913c":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",[i("view",{staticClass:"navigation",style:{height:t.height}},[i("navigator",{staticClass:"left",attrs:{"open-type":"navigateBack","hover-class":"none"}},[i("image",{attrs:{src:"../../static/Merchan_registration/back.png",mode:""}})]),i("view",{staticClass:"title"},[t._v("创建团购")]),i("view",{staticClass:"right",attrs:{eventid:"1b0e8134-0"},on:{tap:function(e){t.sub()}}},[t._v("提交")])],1),i("view",{staticClass:"content",style:{paddingTop:t.height}},[t._m(0),i("view",{staticClass:"main_img"},[i("image",{attrs:{mode:"aspectFit",src:t.main_img,eventid:"1b0e8134-1"},on:{tap:t.add_main_img}})]),t._m(1),i("view",{staticClass:"img_list",class:{active:!t.img_list[0]}},[t._l(t.img_list,function(e,s){return i("view",{key:s},[i("image",{attrs:{mode:"aspectFit",src:e,alt:""}}),i("image",{staticClass:"clear",attrs:{src:"../../static/user/sc.png",alt:"",eventid:"1b0e8134-2-"+s},on:{tap:function(e){t.clear(s)}}})])}),i("view",{staticClass:"add_img",attrs:{eventid:"1b0e8134-3"},on:{tap:t.add_img}},[i("image",{attrs:{mode:"aspectFit",src:"../../static/user/add.png",alt:""}})]),0==t.img_list.length?i("view",{staticClass:"photo",attrs:{eventid:"1b0e8134-4"},on:{tap:t.add_img}},[i("image",{staticClass:"fm",attrs:{src:"../../static/user/scxqt.png"}})]):t._e()],2),i("view",{staticClass:"div"},[i("view",{staticClass:"div_list"},[i("text",[t._v("团购标题")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.buy_title,expression:"buy_title"}],attrs:{type:"text",placeholder:"请输入团购标题",eventid:"1b0e8134-5"},domProps:{value:t.buy_title},on:{input:function(e){e.target.composing||(t.buy_title=e.target.value)}}})]),i("view",{staticClass:"div_list"},[i("text",[t._v("团购价格")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.buy_price,expression:"buy_price"}],attrs:{type:"text",placeholder:"请输入团购价格",eventid:"1b0e8134-6"},domProps:{value:t.buy_price},on:{input:function(e){e.target.composing||(t.buy_price=e.target.value)}}})])]),i("view",{staticClass:"div"},[i("view",{staticClass:"div_list",attrs:{eventid:"1b0e8134-7"},on:{tap:function(e){t.tg="block"}}},[i("text",[t._v("团购政策")]),i("view",[0==t.policy_selection.length?i("text",[t._v("请选择团购政策")]):i("text",[t._v(t._s(t.policy_selection.join(",")))]),i("image",{attrs:{src:"../../static/user/right.png",mode:""}})])]),i("view",{staticClass:"div_list",attrs:{eventid:"1b0e8134-8"},on:{tap:function(e){t.valid_tg="block"}}},[i("text",[t._v("有效期")]),i("view",[""==t.startTime||""==t.endTime?i("text",[t._v("请选择有效期")]):i("text",[t._v(t._s(t.startTime)+"至"+t._s(t.endTime))]),i("image",{attrs:{src:"../../static/user/right.png",mode:""}})])]),i("view",{staticClass:"div_list",attrs:{eventid:"1b0e8134-9"},on:{tap:function(e){t.Shopping="block"}}},[i("text",[t._v("消费时间")]),i("view",[""==t.shop_time?i("text",[t._v("请选择消费时间")]):i("text",[t._v(t._s(t.shop_time))]),i("image",{attrs:{src:"../../static/user/right.png",mode:""}})])])]),i("view",{staticClass:"notice"},[i("view",{staticClass:"notice_title"},[t._v("购买须知")]),t._l(t.notice,function(e,s){return i("view",{key:s,staticClass:"notice_list",attrs:{eventid:"1b0e8134-10-"+s},on:{tap:function(e){t.select(s)}}},[i("view",[i("image",{attrs:{src:"../../static/user/dian.png",mode:""}}),i("text",[t._v(t._s(e))])]),i("view",[i("image",{attrs:{src:t.notice_btn[s].state?t.selection:t.unchecked,mode:""}})])])})],2),t._m(2)]),i("view",{staticClass:"mask",style:{display:t.tg}},[i("view",{staticClass:"norms"},[i("view",{staticClass:"title"},[t._v("团购政策")]),t._l(t.policy,function(e,s){return i("view",{key:s,staticClass:"policy_list",attrs:{eventid:"1b0e8134-11-"+s},on:{tap:function(e){t.choice(s)}}},[i("text",[t._v(t._s(e))]),i("image",{attrs:{src:t.switch_list[s].selected?t.selection:t.unchecked,mode:""}})])}),i("view",{staticClass:"btn"},[i("text",{staticClass:"cancel",attrs:{eventid:"1b0e8134-12"},on:{tap:function(e){t.cancel()}}},[t._v("取消")]),i("text",{staticClass:"determine",attrs:{eventid:"1b0e8134-13"},on:{tap:function(e){t.determine()}}},[t._v("确定")])])],2)]),i("view",{staticClass:"mask",style:{display:t.valid_tg}},[i("view",{staticClass:"norms"},[i("view",{staticClass:"title"},[t._v("有效期")]),i("view",{staticClass:"div_list"},[i("text",[t._v("开始日期")]),i("picker",{attrs:{mode:"date",value:t.date,start:t.startDate,end:t.endDate,eventid:"1b0e8134-14"},on:{change:t.start_times}},[i("text",{directives:[{name:"show",rawName:"v-show",value:""==t.startTime,expression:"startTime==''"}]},[t._v("请选择开始时间")]),i("text",[t._v(t._s(t.startTime))])])],1),i("view",{staticClass:"div_list"},[i("text",[t._v("结束日期")]),i("picker",{attrs:{mode:"date",value:t.date,start:t.startTime,end:t.endDate,eventid:"1b0e8134-15"},on:{change:t.endTimes}},[i("text",{directives:[{name:"show",rawName:"v-show",value:""==t.endTime,expression:"endTime==''"}]},[t._v("请选择结束时间")]),i("text",[t._v(t._s(t.endTime))])])],1),i("view",{staticClass:"btn"},[i("text",{staticClass:"cancel",attrs:{eventid:"1b0e8134-16"},on:{tap:function(e){t.cancel()}}},[t._v("取消")]),i("text",{staticClass:"determine",attrs:{eventid:"1b0e8134-17"},on:{tap:t.time_btn}},[t._v("确定")])])])]),i("view",{staticClass:"mask",style:{display:t.Shopping}},[i("view",{staticClass:"norms"},[i("view",{staticClass:"title"},[t._v("消费时间")]),i("view",{staticClass:"policy_list",attrs:{eventid:"1b0e8134-18"},on:{tap:function(e){t.same_time=!1}}},[i("image",{attrs:{src:t.same_time?t.unchecked:t.selection,mode:""}}),i("text",[t._v("24小时可用")])]),i("view",{staticClass:"policy_list",attrs:{eventid:"1b0e8134-19"},on:{tap:function(e){t.same_time=!0}}},[i("image",{attrs:{src:t.same_time?t.selection:t.unchecked,mode:""}}),i("text",[t._v("部分时间可用")])]),i("view",{directives:[{name:"show",rawName:"v-show",value:t.same_time,expression:"same_time"}]},[i("view",{staticClass:"div_list"},[i("text",[t._v("开始时间")]),i("picker",{attrs:{mode:"time",value:t.time,start:"00:00",end:"24:00",eventid:"1b0e8134-20"},on:{change:t.start_shop}},[i("view",{directives:[{name:"show",rawName:"v-show",value:""==t.start_shop_time,expression:"start_shop_time==''"}]},[t._v("请选择开始时间")]),i("view",{staticClass:"uni-input"},[t._v(t._s(t.start_shop_time))])])],1),i("view",{staticClass:"div_list"},[i("text",[t._v("结束时间")]),i("picker",{attrs:{mode:"time",value:t.time,start:t.start_shop_time,end:"24:00",eventid:"1b0e8134-21"},on:{change:t.end_shop}},[i("view",{directives:[{name:"show",rawName:"v-show",value:""==t.end_shop_time,expression:"end_shop_time==''"}]},[t._v("请选择结束时间")]),i("view",{staticClass:"uni-input"},[t._v(t._s(t.end_shop_time))])])],1)]),i("view",{staticClass:"btn"},[i("text",{staticClass:"cancel",attrs:{eventid:"1b0e8134-22"},on:{tap:function(e){t.cancel()}}},[t._v("取消")]),i("text",{staticClass:"determine",attrs:{eventid:"1b0e8134-23"},on:{tap:t.shop_btn}},[t._v("确定")])])])])])},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"title"},[t._v("上传主图"),i("text",[t._v("(上传一张主图，尺寸比例为100*100)")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"title"},[t._v("上传详情图"),i("text",[t._v("(最多上传9张)")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"introduce"},[i("text",{staticClass:"title"},[t._v("套餐介绍")]),i("view",[i("text",[t._v("套餐介绍文字套餐介绍文字套餐介绍文字套餐介绍文字套餐介绍文字套餐介绍文字套餐介绍文字套餐介绍文字套餐介绍文字套餐介绍文字套餐介")])])])}];i.d(e,"a",function(){return s}),i.d(e,"b",function(){return a})},b5ca:function(t,e,i){"use strict";(function(t){function i(t){var e=new Date,i=e.getFullYear(),s=e.getMonth()+1,a=e.getDate();return"start"===t?i-=100:"end"===t&&(i+=100),s=s>9?s:"0"+s,a=a>9?a:"0"+a,"".concat(i,"-").concat(s,"-").concat(a)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={data:function(){return{date:i({format:!0}),height:"",buy_title:"",buy_price:"",notice:["无需预约","提供免费WIFI","免费停车场","支持急速退","商家提供发票","不同时销售商户其他优惠"],notice_btn:[{id:0,state:!0},{id:1,state:!0},{id:2,state:!0},{id:3,state:!0},{id:4,state:!0},{id:5,state:!0}],main_img:"../../static/user/sczt.png",main_id:"",img_list:[],policy:["随时退","过期退","免预约"],selection:"../../static/user/xz.png",unchecked:"../../static/user/wxz.png",switch_list:[{id:0,selected:!0},{id:1,selected:!0},{id:2,selected:!0}],selection_list:[],selection_text:[],policy_selection:[],tg:"none",startDate:i("start"),endDate:i("end"),startTime:"",endTime:"",valid_tg:"none",Shopping:"none",time:"0:00",start_shop_time:"",end_shop_time:"",shop_time:"",shop_time_list:["24小时可用","部分时间可用"],same_time:!1,img_id:[],merchantId:"",activitiesId:"",establish:"/api/merchant/commodity/groupBuy/add",modify:"/api/merchant/commodity/groupBuy/update",address:"",new_img:[]}},onLoad:function(e){console.log(e);var i=this;i.activitiesId=e.activitiesId,console.log(e.activitiesId),t.getStorage({key:"userinfo",success:function(t){i.merchantId=t.data.id,void 0!=e.activitiesId&&i.getInfor()}})},onReady:function(){this.getTopheight()},methods:{getTopheight:function(){var e=this;t.getSystemInfo({success:function(t){e.height=t.statusBarHeight+44+"px"}})},add_main_img:function(){var e=this;t.chooseImage({count:1,sizeconfirmtype:["original","compressed"],success:function(i){var s=i.tempFiles;e.main_img=s[0].path,t.uploadFile({url:e.serveipd+"/ajax/upfile",filePath:e.main_img,name:"upfile",formData:{},success:function(t){e.main_id=parseInt(JSON.parse(t.data).id),console.log(e.main_id)}})}})},add_img:function(){if(9!=this.img_list.length){var e=this;t.chooseImage({count:9-e.img_list.length,sizeconfirmtype:["original","compressed"],success:function(i){for(var s=[],a=i.tempFiles,n=0;n<a.length;n++)s.push(a[n].path);e.img_list=e.img_list.concat(s);for(var o=0;o<s.length;o++)t.uploadFile({url:e.serveipd+"/ajax/upfile",filePath:s[o],name:"upfile",formData:{},success:function(t){e.img_id.push(JSON.parse(t.data).id)}});console.log(e.img_id)}})}else t.showToast({title:"最多只能上传9张",icon:"none",mask:!1,duration:1500})},clear:function(t){this.img_list.splice(t,1),this.img_id.splice(t,1)},determine:function(){this.tg="none";for(var t=[],e=[],i=0;i<this.switch_list.length;i++)1==this.switch_list[i].selected&&(t.push(this.switch_list[i].id),e.push(this.policy[i]));this.selection_list=t,this.policy_selection=e},cancel:function(){this.tg="none",this.valid_tg="none",this.Shopping="none"},choice:function(t){this.switch_list[t].selected=!this.switch_list[t].selected},start_times:function(t){this.startTime=t.target.value},endTimes:function(t){this.endTime=t.target.value},time_btn:function(){var e=this,i=new Date(e.startTime),s=new Date(e.endTime);i.getTime()>s.getTime()?t.showToast({title:"结束时间不能小于开始时间",icon:"none",mask:!1,duration:2e3}):this.valid_tg="none"},start_shop:function(t){this.start_shop_time=t.detail.value},end_shop:function(t){this.end_shop_time=t.detail.value},shop_btn:function(){if(0==this.same_time)this.shop_time="24小时可用";else if(""!=this.start_shop_time&&""!=this.end_shop_time){if(this.start_shop_time>this.end_shop_time)return void t.showToast({title:"结束时间不能小于开始时间",icon:"none",mask:!1,duration:2e3});this.shop_time=this.start_shop_time+"至"+this.end_shop_time}this.Shopping="none"},select:function(t){this.notice_btn[t].state=!this.notice_btn[t].state},sub:function(){var e=this;if(void 0==e.activitiesId?e.address=e.establish:e.address=e.modify,t.showLoading({title:"生成团购中",mask:!1}),"../../static/user/sczt.png"!=e.main_img)if(0!=e.img_list.length)if(""!=e.buy_title)if(""!=e.buy_price)if(0!=e.policy_selection.length)if(""!=e.startTime&&""!=e.endTime){var i=new Date(e.startTime),s=new Date(e.endTime);if(i.getTime()>s.getTime())t.showToast({title:"结束时间不能小于开始时间",icon:"none",mask:!1,duration:2e3});else if(""!=e.shop_time){for(var a=[],n=0;n<e.notice_btn.length;n++)1==e.notice_btn[n].state&&a.push(e.notice_btn[n].id);t.request({url:e.serveipd+e.address,method:"POST",data:{id:e.activitiesId,merchantId:e.merchantId,consumeStartTime:e.start_shop_time,consumeEndTime:e.end_shop_time,icon:e.main_id,consumedAllHours:!e.same_time,images:e.img_id.join(","),name:e.buy_title,price:e.buy_price,labels:e.selection_list.join(","),startTime:e.startTime,endTime:e.endTime,tips:a.join(",")},success:function(e){t.hideLoading(),t.showToast({title:e.data.msg,icon:"none",mask:!1,duration:1500,success:function(){setTimeout(function(){t.redirectTo({url:"./marketing",success:function(t){},fail:function(){},complete:function(){}})},1500)}})}})}else t.showToast({title:"请选择消费时间",icon:"none",mask:!1,duration:1500})}else t.showToast({title:"请选择有效期",icon:"none",mask:!1,duration:1500});else t.showToast({title:"请选择团购政策",icon:"none",mask:!1,duration:1500});else t.showToast({title:"请输入团购价格",icon:"none",mask:!1,duration:1500});else t.showToast({title:"请输入团购标题",icon:"none",mask:!1,duration:1500});else t.showToast({title:"请上传详情图",icon:"none",mask:!1,duration:1500});else t.showToast({title:"请上传一张主图",icon:"none",mask:!1,duration:1500})},getInfor:function(){var e=this;t.request({url:e.serveipd+"/api/merchant/commodity/groupBuy/"+e.activitiesId,method:"GET",data:{merchantId:e.merchantId},success:function(t){console.log(t);var i=t.data.data;e.main_img=i.iconUrl,e.img_list=i.imageUrls,e.buy_title=i.name,e.buy_price=i.price,e.selection_list=i.labels.split(","),e.start_shop_time=i.consumeStartTime,e.end_shop_time=i.consumeEndTime,e.startTime=i.startTime,e.endTime=i.endTime,i.consumedAllHours?e.shop_time="24小时可用":e.shop_time=i.consumeStartTime+"至"+i.consumeEndTime,e.switch_list=[{id:0,selected:!1},{id:1,selected:!1},{id:2,selected:!1}];for(var s=[],a=i.labels.split(","),n=0;n<a.length;n++)s.push(e.policy[a[n]]),e.switch_list[a[n]].selected=!0;e.policy_selection=s,e.notice_btn=[{id:0,state:!1},{id:1,state:!1},{id:2,state:!1},{id:3,state:!1},{id:4,state:!1},{id:5,state:!1}];for(var o=i.tips.split(","),c=0;c<o.length;c++)e.notice_btn[o[c]].state=!0}})}}};e.default=s}).call(this,i("6e42")["default"])},d4a5:function(t,e,i){"use strict";i.r(e);var s=i("b5ca"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,function(){return s[t]})}(n);e["default"]=a.a}},[["3448","common/runtime","common/vendor"]]]);